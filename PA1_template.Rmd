---
title: "Reproducible Research: Peer Assessment 1"
author: "John Wright"
date: "Saturday, July 12, 2014"
output: html_document
---

## Loading data and packages
This code assumes the raw data is located in your working directory.
```{r, echo=TRUE}
library(ggplot2)
dir <- getwd()
data <- read.csv(file.path(dir, "activity.csv"))
```

## Total steps per day
The total number of steps taken each day is represented in the histogram below:
```{r, echo=TRUE}
totalStepsPerDay <- aggregate(steps ~ date, data = data[!is.na(data$steps), ], FUN = sum)

qplot(x = totalStepsPerDay$steps, geom = "histogram", xlab = "Total Steps", ylab = "Count", bindwidth = 700, main = "Total Number of Steps Taken Each Day")
```

The mean and median total steps each day are:
```{r, echo=TRUE}
mean(totalStepsPerDay$steps)
median(totalStepsPerDay$steps)
```

## Average daily activity pattern
```{r, echo=TRUE}
avgStepsPerInterval <- aggregate(steps ~ interval, data = data[!is.na(data$steps), ], FUN = mean)
#
datestring <- strptime(sprintf("%04d", as.numeric(as.character(avgStepsPerInterval$interval))), "%H%M")
#
avgStepsPerInterval$interval <- strptime(sprintf("%04d", as.numeric(as.character(avgStepsPerInterval$interval))), "%H%M")
#
avgStepsPerInterval$interval <- as.numeric(datestring - trunc(datestring, "days"))
#
avgStepsPerInterval$interval <- as.POSIXct(avgStepsPerInterval$interval)
#
mostSteps <- max(avgStepsPerInterval$steps)
mostStepsInterval <- avgStepsPerInterval[avgStepsPerInterval$steps == mostSteps, 1]

qplot(x = avgStepsPerInterval$interval, 
      y = avgStepsPerInterval$steps, 
      geom = "line", 
      xlab = "Interval (minutes)",
      ylab = "Average Steps Per Interval") + 
      scale_x_datetime(labels = format("%S:00")) + 
      geom_point(data = data.frame(mostStepsInterval, mostSteps), 
                 aes(mostStepsInterval, mostSteps), 
                 colour = "red2", 
                 size = 4) + 
      annotate("text", 
               label = paste("Max steps: ", 
                             round(mostSteps, 0), 
                             "\nInterval: ",
                             mostStepsInterval), 
               x = mostStepsInterval + 120, 
               y = mostSteps, 
               size = 4)

#convert the interval into a timestamp to make the graph more readable.
```
Interval 835 has the maximum amount of steps on average.


## Imputing missing values
There are 2304 instances of missing values in the activity dataset. These values have been imputed by using the average steps for each time interval calculated above. The average number of steps taken for a given time interval has been used to represent the amount of steps taken wherever there was a missing value in the original dataset. The new imputed dataset is stored in `complete` below.

```{r, echo = TRUE}
nrow(data) - sum(complete.cases(data))

imputedVals <- merge(data[is.na(data$steps), ], 
                     avgStepsPerInterval, 
                     by = "interval")[, c(4, 3, 1)]

colnames(imputedVals) <- colnames(data)
cleanOrigData <- data[!is.na(data$steps), ]
complete <- rbind(imputedVals, cleanOrigData)

totalStepsPerDayImputed <- aggregate(steps ~ date, data = complete, FUN = sum)
qplot(x = totalStepsPerDayImputed$steps, geom = "histogram", xlab = "Total Steps", ylab = "Count", binwidth = 700, main = "Total Number of Steps Taken Each Day")

#find a way to layer the new graph ontop of the old one to see the difference
totalStepsPerDay$Set <- as.factor("Original")
totalStepsPerDayImputed$Set <- as.factor("Imputed")
graphData <- rbind(totalStepsPerDay, totalStepsPerDayImputed)
ggplot(graphData, aes(steps, fill = Set)) + 
  geom_histogram(alpha = 0.5, position = "identity", binwidth = 700) + 
  scale_fill_manual(values = c(Imputed = "grey50", Original = "black")) +
  xlab("Steps") +
  ylab("Count") +
  ggtitle("Average Total Steps Per Day\n Original vs Imputed Missing Values") +
  theme(plot.title = element_text(face = "bold", size = "14"))
```


## Are there differences in activity patterns between weekdays and weekends?
```{r, echo = TRUE}
isWeekend <- function(x) {
  if (weekdays(as.Date(x)) %in% c("Saturday", "Sunday")) {
    return ("Weekend")
    } else return ("Weekday")
}

complete$is_weekend <- as.factor(sapply(as.Date(complete$date, "%Y-%m-%d"), FUN = isWeekend))
complete <- complete[order(complete$interval), ]

weekendData <- aggregate(steps ~ interval, data = complete[complete$is_weekend == "Weekend", ], FUN = mean)
weekdayData <- aggregate(steps ~ interval, data = complete[complete$is_weekend == "Weekday", ], FUN = mean)

par(mfrow = c(2, 1))
plot(weekendData$steps, type = "l", ylab = "Weekend")
plot(weekdayData$steps, type = "l", ylab = "Weekday")

qplot(x = weekendData$interval,
      y = weekendData$steps,
      geom = "line",
      xlab = "Interval",
      ylab = "Steps")
qplot(x = weekdayData$interval,
      y = weekdayData$steps,
      geom = "line",
      xlab = "Interval",
      ylab = "Steps")
```

